---
# Systemd service setup tasks

- name: Create systemd service file from template
  ansible.builtin.template:
    src: github-runner.service.j2
    dest: "/etc/systemd/system/{{ github_runner_service_name }}.service"
    owner: root
    group: root
    mode: '0644'
  become: yes
  notify: Reload systemd
  tags:
    - service

- name: Flush handlers to reload systemd
  ansible.builtin.meta: flush_handlers
  tags:
    - service

- name: Enable GitHub runner service (but don't start it)
  ansible.builtin.systemd:
    name: "{{ github_runner_service_name }}"
    enabled: "{{ github_runner_service_enabled }}"
    daemon_reload: yes
  become: yes
  tags:
    - service

- name: Display service status information
  ansible.builtin.debug:
    msg:
      - "GitHub Actions Runner service has been configured:"
      - "  - Service name: {{ github_runner_service_name }}"
      - "  - Service enabled: {{ github_runner_service_enabled }}"
      - "  - Service state: Not started (requires manual configuration first)"
      - ""
      - "To check service status after configuration:"
      - "  sudo systemctl status {{ github_runner_service_name }}"
  tags:
    - service
