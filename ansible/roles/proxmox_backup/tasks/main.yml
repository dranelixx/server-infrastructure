---
# Main tasks for Proxmox Backup role

- name: Include validation tasks
  ansible.builtin.import_tasks: validate.yml
  tags:
    - proxmox-backup
    - validate

- name: Include SSH key tasks
  ansible.builtin.import_tasks: ssh-key.yml
  tags:
    - proxmox-backup
    - ssh-key

- name: Include script deployment tasks
  ansible.builtin.import_tasks: script.yml
  tags:
    - proxmox-backup
    - script

- name: Include cron job tasks
  ansible.builtin.import_tasks: cron.yml
  tags:
    - proxmox-backup
    - cron

- name: Include logrotate tasks
  ansible.builtin.import_tasks: logrotate.yml
  when: proxmox_backup_logrotate_enabled | bool
  tags:
    - proxmox-backup
    - logrotate

- name: Display setup summary
  ansible.builtin.debug:
    msg:
      - "=========================================="
      - "Proxmox Backup Setup Complete!"
      - "=========================================="
      - ""
      - "Configuration:"
      - "  Remote: {{ proxmox_backup_remote_user }}@{{ proxmox_backup_remote_host }}:{{ proxmox_backup_remote_port }}"
      - "  Path: {{ proxmox_backup_remote_path }}"
      - "  Retention: {{ proxmox_backup_retention_days }} days"
      - >-
        Schedule: {{ proxmox_backup_cron_minute }}
        {{ proxmox_backup_cron_hour }}
        {{ proxmox_backup_cron_day }}
        {{ proxmox_backup_cron_month }}
        {{ proxmox_backup_cron_weekday }}
      - ""
      - "Files:"
      - "  Script: {{ proxmox_backup_script_path }}"
      - "  Log: {{ proxmox_backup_log_path }}"
      - "  SSH Key: {{ proxmox_backup_ssh_key_path }}"
      - ""
      - "Test manually:"
      - "  {{ proxmox_backup_script_path }}"
      - "=========================================="
  tags:
    - proxmox-backup
